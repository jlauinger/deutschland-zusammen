{% extends 'offers/base.html' %}
{% load bootstrap4 %}
{% load static %}
{% load i18n %}

{% block footerpadding %}{% endblock %}

{% block content %}
    <div class="bg-image">
        <div class="container padding-top-1">
            <div class="search-form">
                <div class="inner-search">
                    <h2>{% trans "Deutschland steht zusammen. Finde Hilfe in der Corona-Krise" %}</h2>

                    <form method="POST" action="">
                        {% csrf_token %}

                        {{ form.where }}
                        <a href="#" id="locate">
                            <img src="{% static 'offers/images/crosshair.png' %}"
                                 alt="{% trans "Versuche mich zu orten" %}"
                                 title="{% trans "Versuche mich zu orten" %}" />
                        </a>

                        <div class="hidden-sm-up padding-top-1"></div>

                        {{ form.when }}
                        <a href="#" id="today">
                            <img src="{% static 'offers/images/today-icon.png' %}" alt="{% trans "Heute" %}"
                                 title="{% trans "Heute" %}" />
                        </a>

                        <div class="display-none">
                            {{ form.mobility }}
                            {{ form.daytime }}
                        </div>

                        <div class="hidden-sm-up padding-top-1"></div>
                        <input type="submit" value="{% trans "Suchen!" %}" class="btn btn-primary">
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="content-below-fold">
        <div class="container centering">
            <h2>Das ist "Deutschland Zusammen":</h2>

            <p class="text">
                Mit diesem Portal möchten wir helfenden und hilfesuchende Menschen die Möglichkeit geben einander zu
                finden. In Zeiten wie diesen ist es besonders wichtig, dass wir alle aufeinander Acht geben und uns
                gegenseitig helfen. deutschlandzusammen.de bringt Menschen, die Nachbarschaftshilfe suchen mit Menschen,
                die Hilfe anbieten in Kontakt.
            </p>
            <p class="text">
                Wenn du Hilfe benötigst, gib oben deinen Straßennamen und deinen Ort (z.B. "Lessingstraße, Hannover")
                an, sowie das Datum an dem du suchst. Wir suchen dann automatisch in deinem Umkreis nach Menschen, die
                bereit sind dir zu helfen.
            </p>
            <p>
                <a href="#" class="btn btn-primary btn-lg">Jetzt nach Hilfe suchen</a>
            </p>

            <div class="padding-top-1"></div>
            <h2>So funktioniert's:</h2>
            <p class="text">
                Kannst du dir vorstellen, deinen Nachbar*innen z.B. beim Einkaufen, beim Abholen von Medikamenten,
                beim Einwerfen ihrer Post, beim Gassi gehen, oder was auch immer dir einfällt, zu helfen? Super,
                Menschen wie du sind in Zeiten wie der Corona-Krise Held*innen deiner Nachbarschaft!
            </p>
            <p class="text">
                Du estellst ein Profil, in dem du uns verrätst wie du heißt, wo du wohnst und welche Art von Hilfe du
                anbieten kannst. Du gibst auch einen Umkreis um deinen Wohnort an, in dem du Hilfesuchende erreichen
                kannst, z.B. 2 Kilometer. Keine Angst, deine Adresse wird niemals öffentlich angezeigt.
            </p>
            <p class="text">
                Sobald du über die Suche gefunden wurdest, kann die suchende Person dir eine Nachricht direkt über
                deutschlandzusammen.de schreiben. Du erhältst sie per E-Mail und in dein Profil. Wir können sie dir
                auch über eine Push-Nachricht direkt an dein Handy senden, wenn du möchtest! Damit es noch schneller
                geht kannst du auch deine E-Mail-Adresse oder Telefonnummer in dein Profil stellen, aber bedenke dabei
                dass sie dann öffentlich im Internet sichtbar ist. Weitere Hinweise wie du auf deine Privatsphäre und
                Sicherheit achten kannst haben wir dir
                <a href="{% url 'safety_information' %}" class="text-link">hier</a> zusammengestellt.
            </p>
            <p class="text">
                Bist du überzeugt? Dann erstellen dir gleich deinen Account! Gemeinsam sind wir stärker als das
                Corona-Virus!
            </p>
            <p>
                <a href="{% url 'register' %}" class="btn btn-primary btn-lg">Jetzt Hilfe anbieten</a>
            </p>

            <div class="padding-top-1"></div>
            <h2>Achte auf Dich!</h2>
            <p class="text">
                Das Coronavirus kann von Mensch zu Mensch übertragen werden. Wenn du anderen Menschen helfen möchtest,
                sei also bitte besonders vorsichtig. Achte auch unbedingt auf gute
                <a href="https://www.infektionsschutz.de/haendewaschen/" target="_blank" rel="" class="text-link"
                   title="Internetseite der Bundeszentrale für gesundheitliche Aufklärung">Handhygiene</a>,
                <a href="https://www.infektionsschutz.de/hygienetipps/hygiene-beim-husten-und-niesen/" target="_blank"
                   class="text-link" title="Internetseite der Bundeszentrale für gesundheitliche Aufklärung">
                    Husten- und Nies-Etikette
                </a>
                sowie
                <a href="https://www.infektionsschutz.de/hygienetipps/barrieremassnahmen/" class="text-link"
                   target="_blank" title="Internetseite der Bundeszentrale für gesundheitliche Aufklärung">
                    Abstand zu Erkrankten.
                </a><br /><br />
                <a href="https://www.infektionsschutz.de/coronavirus/verhalten.html" target="_blank" class="text-link">
                    Allgemeine Verhaltenshinweise der Bundesregierung
                </a>
            </p>
        </div>
    </div>

    <div class="bg-primary">
        <div class="container centering social-media-links">
            <div class="social-media-link">
                <a href="https://www.instagram.com/deutschlandzusammen/" target="_blank">
                    <i class="fab fa-instagram"></i><br />
                    @deutschlandzusammen
                </a>
            </div>
            <div class="social-media-link">
                <a href="https://www.twitter.com/deutschlandzus" target="_blank">
                    <i class="fab fa-twitter"></i><br />
                    @deutschlandzus
                </a>
            </div>
            <div class="social-media-link">
                <a href="https://www.facebook.com/deutschland.zusammen.5" target="_blank">
                    <i class="fab fa-facebook"></i><br />
                    Deutschland Zusammen
                </a>
            </div>
        </div>
        <div class="container centering hashtag">
            <div>#WirGegenDeutschland</div><br />
            <a href="mailto:hallo@deutschlandzusammen.de" class="text-link">hallo@deutschlandzusammen.de</a>
        </div>
    </div>

    <script>
        $(function () {
            let whereField = $('#id_where');
            let whenField = $('#id_when');

            // datepicker for when field
            whenField.datetimepicker({
                format: 'd.m.Y',
                timepicker: false
            });

            // image slideshow
            var images = ['static/offers/images/bild-1.jpg', 'static/offers/images/bild-2.jpg',
                'static/offers/images/bild-4.jpg','static/offers/images/bild-5.jpg', 'static/offers/images/bild-6.jpg'
            ];
            var index = 0;
            var period = 10000;

            var cycle = function() {
                index = (index + 1) % images.length;
                $('.bg-image').css({'background-image': 'url("'+images[index]+'")'});
                setTimeout(cycle, period);
            };

            setTimeout(cycle, period);

            // prefetch images
            var curImg = new Image();
            var prefetchNext = function(i) {
                curImg.src = images[i];
                curImg.onload = function() {
                    if (i < images.length - 1) {
                        prefetchNext(i+1);
                    }
                }
            };
            prefetchNext(1);

            // set date to today button
            $('#today').click(function () {
                var date = new Date();
                whenField.val((""+date.getDate()).padStart(2, "0") + "." + (""+(date.getMonth()+1)).padStart(2, "0") +
                    "." + date.getFullYear());
                return false;
            });

            // geolocation for where field
            $('#locate').click(function() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function success (position) {
                        updateWhereFieldWithAddress(position.coords.latitude, position.coords.longitude);
                    }, function error (error) {
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                // do nothing
                                break;
                            case error.POSITION_UNAVAILABLE:
                                alert("{% trans "Standortdaten sind nicht verfügbar." %}");
                                break;
                            case error.TIMEOUT:
                                alert("{% trans "Die Standortabfrage dauerte zu lange (Time-out)." %}");
                                break;
                            case error.UNKNOWN_ERROR:
                                alert("{% trans "Unbekannter Fehler." %}");
                                break;
                        }

                    });
                } else {
                    alert("{% trans "Ihr Browser unterstützt keine Ortung." %}");
                }
            });

            var updateWhereFieldWithAddress = function(lat, lng) {
                $.get('{% url 'ajax_address' %}', {
                    lat: lat,
                    lng: lng
                }, function (address) {
                    $('#id_where').val(address);
                });
            };

            // address autocomplete
            var getAutocompleteOptions = function(query, callback) {
                $.get('{% url 'ajax_autocomplete' %}', {
                    q: query
                }, function (response) {
                    suggestions = JSON.parse(response);
                    suggestions = suggestions.slice(0, Math.min(5, suggestions.length));
                    callback(suggestions);
                });
            };
            whereField.autocomplete({
                source: function(request, response) {
                    getAutocompleteOptions(request.term, response)
                },
                minLength: 3
            });

            // address local storage
            let LOCAL_STORAGE_LAST_QUERY = 'lastLocationQuery';
            let LOCAL_STORAGE_LAST_DATE = 'lastDateQuery';

            whereField.change(function() {
                localStorage.setItem(LOCAL_STORAGE_LAST_QUERY, $(this).val());
            });
            if(localStorage.getItem(LOCAL_STORAGE_LAST_QUERY)) {
                whereField.val(localStorage.getItem(LOCAL_STORAGE_LAST_QUERY));

            }
            whenField.change(function() {
                localStorage.setItem(LOCAL_STORAGE_LAST_DATE, $(this).val());
            });
            if (localStorage.getItem(LOCAL_STORAGE_LAST_DATE)) {
                whenField.val(localStorage.getItem(LOCAL_STORAGE_LAST_DATE));
            }
        });
    </script>
{% endblock %}